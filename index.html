<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TypeDrop — Daily TypeScript Challenges</title>
  <meta name="description" content="A new TypeScript challenge every day. AI-generated, open source, zero setup — just click and code in CodeSandbox.">
  <meta property="og:title" content="TypeDrop — Daily TypeScript Challenges">
  <meta property="og:description" content="A new TypeScript challenge every day. Sharpen your types.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://niltonheck.github.io/typedrop/">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="TypeDrop — Daily TypeScript Challenges">
  <meta name="twitter:description" content="A new TypeScript challenge every day. AI-generated, open source, zero setup.">
  <link rel="icon" href="misc/favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/fontsource/fonts/0x-proto@latest/latin-400-normal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/fontsource/fonts/0x-proto@latest/latin-700-normal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a href="#challenge" class="skip-link">Skip to challenge</a>
  <main>
    <header>
      <h1>TypeDrop</h1>
      <p class="tagline">A new TypeScript challenge every day. Sharpen your types.</p>
    </header>

    <!-- CHALLENGE_START -->
    <section class="challenge-card">
      <div class="challenge-header">
        <span class="challenge-date">2026-02-18</span>
        <span class="badge medium">Medium</span>
      </div>
      <h2>Typed Event Emitter with Middleware Chain</h2>
      <p>You're building a plugin-friendly analytics SDK where every tracked event flows through a configurable middleware chain before being dispatched. Each middleware can transform the event payload, short-circuit the chain, or pass control to the next handler — all with full type safety across a heterogeneous event map.</p>
      <div class="challenge-goals">
        <h3>Goals</h3>
        <ul>
          <li>Define the `Middleware&lt;TPayload&gt;` type and implement `composeMiddleware` so middleware run left-to-right, threading the payload and supporting short-circuiting.</li>
          <li>Implement `TypedEmitter&lt;TMap&gt;` with per-event middleware and handler registries, keyed by `keyof TMap`.</li>
          <li>Ensure `use`, `on`, and `emit` are fully type-safe: the payload type for each event is inferred from `TMap` without any `any` or casts.</li>
          <li>Handle edge cases: no registered middleware/handlers (no-op), short-circuiting, and multiple terminal handlers all receiving the final mutated payload.</li>
        </ul>
      </div>
      <div class="code-block">
        <div class="code-block-header">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
          <span class="code-block-title">challenge.ts</span>
        </div>
        <pre><code class="language-typescript">// Core types and main class signature at a glance

export type EventMap = Record&lt;string, object&gt;;

export type Middleware&lt;TPayload extends object&gt; = (
  payload: TPayload,
  next: (payload: TPayload) =&gt; void
) =&gt; void;

export function composeMiddleware&lt;TPayload extends object&gt;(
  middlewares: ReadonlyArray&lt;Middleware&lt;TPayload&gt;&gt;
): Middleware&lt;TPayload&gt; { /* ... */ }

// Usage example:
interface AppEvents extends EventMap {
  pageView: { path: string; userId: string };
  purchase: { itemId: string; price: number; currency: string };
}

export class TypedEmitter&lt;TMap extends EventMap&gt; {
  use&lt;K extends keyof TMap&gt;(event: K, mw: Middleware&lt;TMap[K]&gt;): this { /* ... */ }
  on&lt;K extends keyof TMap&gt;(event: K, handler: (payload: TMap[K]) =&gt; void): this { /* ... */ }
  emit&lt;K extends keyof TMap&gt;(event: K, payload: TMap[K]): void { /* ... */ }
}
</code></pre>
      </div>
      <details class="challenge-hints-details">
        <summary>Hints (click to reveal)</summary>
      <div class="challenge-hints">
        <h3>Hints</h3>
        <ul>
          <li>For `composeMiddleware`, think recursively or with `reduceRight` — each middleware wraps the remainder of the chain as its own `next`.</li>
          <li>Inside `TypedEmitter`, you can't use `TMap[K]` as a storage key type directly. Consider using `Map&lt;keyof TMap, ...&gt;` with a helper type or storing handlers as `Array&lt;(p: object) =&gt; void&gt;` keyed by event name — the public API still enforces the correct types.</li>
          <li>Returning `this` from `use` and `on` enables fluent chaining; TypeScript will infer the concrete subclass type if you ever extend `TypedEmitter`.</li>
        </ul>
      </div>
      </details>
      <div class="challenge-docs">
        <h3>Useful resources</h3>
        <ul>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/generics.html" target="_blank" rel="noopener noreferrer">TypeScript Handbook – Generics</a></li>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html" target="_blank" rel="noopener noreferrer">TypeScript Handbook – keyof &amp; Indexed Access Types</a></li>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html" target="_blank" rel="noopener noreferrer">TypeScript Handbook – Mapped Types</a></li>
          <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduceRight" target="_blank" rel="noopener noreferrer">MDN – Array.prototype.reduceRight</a></li>
        </ul>
      </div>
      <a class="cta-button" href="https://codesandbox.io/p/devbox/github/niltonheck/typedrop/tree/challenge/2026-02-18" target="_blank" rel="noopener noreferrer">
        <img class="csb-icon" src="https://cdn.simpleicons.org/codesandbox/e0e0e0" alt=""> Open in CodeSandbox
      </a>
    </section>
    <!-- CHALLENGE_END -->

    <footer>
      <p>
        Challenges are AI-generated and open source.
        <a href="https://github.com/niltonheck/typedrop" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        &middot;
        <a href="archive.html">Archive</a>
      </p>
      <p>
        Built with <svg class="inline-icon heart-icon" viewBox="0 0 24 24" fill="currentColor" aria-label="love"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> and <img src="https://cdn.simpleicons.org/anthropic/d4a27f" alt="Claude" class="inline-icon"> from <a href="https://www.youtube.com/watch?v=s9hl8i_yeUw" target="_blank" rel="noopener noreferrer"><img src="misc/pe-flag.jpg" alt="Peru" class="flag-icon"></a> by
        <a href="https://github.com/niltonheck" target="_blank" rel="noopener noreferrer">@niltonheck</a>
      </p>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-typescript.min.js"></script>
</body>
</html>
