<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TypeDrop — Typed Distributed Cache with TTL &amp; Eviction Policies</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/fontsource/fonts/0x-proto@latest/latin-400-normal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/fontsource/fonts/0x-proto@latest/latin-700-normal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
  <link rel="icon" href="../../misc/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
  <main>
    <header>
      <h1><a href="../../index.html" style="color: inherit; text-decoration: none;">TypeDrop</a></h1>
      <p class="tagline">2026-03-01 Challenge</p>
    </header>

    <section class="challenge-card">
      <div class="challenge-header">
        <span class="challenge-date">2026-03-01</span>
        <span class="badge hard">Hard</span>
      </div>
      <h2>Typed Distributed Cache with TTL &amp; Eviction Policies</h2>
      <p>You're building the caching layer for a high-throughput microservice platform. Each cache namespace has its own value shape, TTL strategy, and eviction policy — and the orchestrator must coordinate reads, writes, and invalidations across multiple namespaces with full compile-time safety on every key-value pair.</p>
      <div class="challenge-goals">
        <h3>Goals</h3>
        <ul>
          <li>Define the `EvictionPolicy` discriminated union and `NamespaceConfig&lt;V&gt;` generic with optional serialize/deserialize pair.</li>
          <li>Implement `NamespaceConfigs&lt;S&gt;` as a mapped type so each namespace key binds to the correctly-typed config.</li>
          <li>Implement `createCacheOrchestrator` with per-namespace LRU eviction, lazy TTL expiry, accurate stats counters, and full `CacheOrchestrator&lt;S&gt;` interface compliance.</li>
          <li>Implement the `cacheKey` branded-type helper with runtime length validation.</li>
        </ul>
      </div>
      <div class="code-block">
        <div class="code-block-header">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
          <span class="code-block-title">challenge.ts</span>
        </div>
        <pre><code class="language-typescript">// Key types at a glance

type AppSchema = {
  users: { id: number; name: string };
  tokens: string;
  counters: number;
};

export type EvictionPolicy =
  | { kind: &quot;lru&quot;; maxSize: number }
  | { kind: &quot;ttl&quot;; defaultTtlMs: number }
  | { kind: &quot;none&quot; };

export type NamespaceConfig&lt;V&gt; = {
  policy: EvictionPolicy;
  serialize?:   (value: V) =&gt; string;
  deserialize?: (raw: string) =&gt; V;
};

export type NamespaceConfigs&lt;S extends CacheSchema&gt; = {
  [K in keyof S]: NamespaceConfig&lt;S[K]&gt;;
};

export interface CacheOrchestrator&lt;S extends CacheSchema&gt; {
  set&lt;K extends keyof S&gt;(ns: K, key: string, value: S[K], ttlMs?: number): void;
  get&lt;K extends keyof S&gt;(ns: K, key: string): S[K] | undefined;
  delete&lt;K extends keyof S&gt;(ns: K, key: string): boolean;
  invalidateNamespace&lt;K extends keyof S&gt;(ns: K): void;
  stats&lt;K extends keyof S&gt;(ns: K): NamespaceStats;
}

export function createCacheOrchestrator&lt;S extends CacheSchema&gt;(
  configs: NamespaceConfigs&lt;S&gt;
): CacheOrchestrator&lt;S&gt; { /* TODO */ throw new Error(&quot;Not implemented&quot;); }</code></pre>
      </div>
      <details class="challenge-hints-details">
        <summary>Hints (click to reveal)</summary>
      <div class="challenge-hints">
        <h3>Hints</h3>
        <ul>
          <li>A `Map&lt;string, Entry&lt;V&gt;&gt;` preserves insertion order — delete then re-insert a key on every access to cheaply maintain LRU order without a doubly-linked list.</li>
          <li>Narrow the eviction policy with a `switch (policy.kind)` inside `set` and `get` so TypeScript's exhaustiveness checking guides you through each branch.</li>
          <li>The `NamespaceConfigs&lt;S&gt;` mapped type only needs one line: `[K in keyof S]: NamespaceConfig&lt;S[K]&gt;` — the hard part is making sure the orchestrator's internal store is also keyed generically over `keyof S`.</li>
        </ul>
      </div>
      </details>
      <div class="challenge-docs">
        <h3>Useful resources</h3>
        <ul>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html" target="_blank" rel="noopener noreferrer">TypeScript Mapped Types</a></li>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions" target="_blank" rel="noopener noreferrer">TypeScript Discriminated Unions</a></li>
          <li><a href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html" target="_blank" rel="noopener noreferrer">TypeScript Generics — Keyof &amp; Indexed Access</a></li>
          <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="noopener noreferrer">MDN — Map (insertion-order iteration)</a></li>
        </ul>
      </div>
      <div class="cta-row">
        <a class="cta-button cta-primary" href="https://stackblitz.com/github/niltonheck/typedrop/tree/challenge/2026-03-01" target="_blank" rel="noopener noreferrer">
          <img class="sb-icon" src="https://cdn.simpleicons.org/stackblitz/e0e0e0" alt=""> StackBlitz
        </a>
        <a class="cta-button" href="https://codesandbox.io/p/devbox/github/niltonheck/typedrop/tree/challenge/2026-03-01" target="_blank" rel="noopener noreferrer">
          <img class="csb-icon" src="https://cdn.simpleicons.org/codesandbox/e0e0e0" alt=""> CodeSandbox
        </a>
      </div>
      <div class="clone-section">
        <h3>Or clone locally</h3>
        <div class="clone-box">
          <code id="clone-cmd">git clone -b challenge/2026-03-01 https://github.com/niltonheck/typedrop.git</code>
          <button class="clone-copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('clone-cmd').textContent).then(()=>{this.textContent='Copied!';this.classList.add('copied');setTimeout(()=>{this.textContent='Copy';this.classList.remove('copied')},2000)})">Copy</button>
        </div>
      </div>
    </section>

    <footer>
      <p>
        <a href="../../index.html">&larr; Today's challenge</a>
        &middot;
        <a href="../../archive.html">Archive</a>
      </p>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-typescript.min.js"></script>
  <script data-goatcounter="https://niltonheck.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>
</html>